generator client {
  provider = "prisma-client"
  output   = "../../generated/prisma"
  // url      = env("DATABASE_URL")
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String    @id 
  name          String?   
  email         String   
  emailVerified Boolean   @default(false)
  image         String?
  role          UserRoles  @default(CUSTOMER)
  phone         String?   
  status        UserStatus @default(ACTIVE)
  address       String?   
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  medicines     Medicine[]  
  orders        Order[]
  reviews       Review[]
  orderItems    OrderItem[]

  sessions      Session[]
  accounts      Account[]

  @@unique([email])
  @@map("user")
}

enum UserRoles {
  CUSTOMER
  SELLER
  ADMIN
}
enum UserStatus {
  ACTIVE
  BANNED
}



model Session {
  id        String   @id
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@index([userId])
  @@map("session")
}

model Account {
  id                    String    @id
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
  @@map("account")
}

model Verification {
  id         String   @id
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
  @@map("verification")
}

model Category {
  id            String    @id @default(uuid())
  name          String    @unique @db.VarChar(100)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  medicines Medicine[]

  @@map("categories")
}

model Medicine {
  id            String    @id @default(uuid())
  name          String    @unique @db.VarChar(150)
  sellerId      String
  seller        User      @relation(fields: [sellerId],references: [id], onDelete: Cascade)
  categoryId    String
  category      Category  @relation(fields: [categoryId],references: [id], onDelete: Cascade)
  description   String    @db.Text
  image         String?
  price         Decimal   @db.Decimal(10,2)
  stock         Int?
  manufacturer  String    @db.VarChar(150)
  isActive      Boolean?  @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  orderItems    OrderItem[] 
  reviews       Review[]

  @@index([sellerId])
  @@index([categoryId])

  @@map("medicines")
}

model Order {
  id               String        @id @default(uuid())
  customerId       String
  customer         User          @relation(fields: [customerId],references: [id], onDelete: Cascade)
  status           OrderStatus   @default(PLACED)
  payment_method   PaymentMethod @default(CASH_ON_DELIVERY)
  shipping_address String        @db.Text
  total_amount     Decimal       @db.Decimal(10,2)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  items            OrderItem[]

  @@index([customerId])
  @@map("orders")
}

enum OrderStatus {
  PLACED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

enum PaymentMethod {
CASH_ON_DELIVERY
}


model OrderItem {
  id          String    @id @default(uuid())
  orderId     String
  order       Order @relation(fields: [orderId],references: [id], onDelete: Cascade)
  medicineId  String
  medicine    Medicine @relation(fields: [medicineId],references: [id], onDelete: Cascade)
  sellerId    String
  seller      User @relation(fields: [sellerId],references: [id], onDelete: Cascade)
  quantity    Int 
  unit_price  Decimal @db.Decimal(10,2)
  sub_total   Decimal @db.Decimal(10,2)

  
  @@index([orderId])
  @@index([sellerId])
  @@index([medicineId])
  @@map("orderItems")
}


model Review {
  id             String    @id @default(uuid())
  medicineId     String
  medicine       Medicine @relation(fields: [medicineId],references: [id], onDelete: Cascade)
  customerId     String
  customer       User @relation(fields: [customerId],references: [id], onDelete: Cascade)
  rating         Int 
  comment        String @db.Text
  createdAt      DateTime  @default(now())

  
  @@index([medicineId])
  @@index([customerId])
  @@map("reviews")
}